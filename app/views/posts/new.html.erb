<div class="main posts-new">
  <div class="container">
    <h1 class="form-heading">投稿する</h1>
    <div class="form-wrapper">
      <%= form_tag("/posts/create") do %>
        <div class="form">
          <div class="form-body">
            <textarea name = "content"></textarea>
            <input id="new-posts" type="hidden" value="投稿">
            <div class="upload-wrapper">
              <input type="text" name="face-picture" id="face-picture" value="https://upload.wikimedia.org/wikipedia/commons/c/c3/RH_Louise_Lillian_Gish.jpg">
              <input type="buttib" id="face-pictures" value="送信" name="submit-image" onclick=detectFace();>
              <div id="imageDiv" style="width:420px; display:table-cell;"></div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
        <!-- <input type="file" name="file"> -->
          Source image:<br><br>
          <img id="sourceImage" width="400" />
    </div>
  </div>
</div>



<!-- #2 切り替えのjQueryと 3 Ajax -->
<script>
  function detectFace() {
      var subscriptionKey = "9428b416c6024673b132a90d379e6a10"
      var uriBase =
          "https://japaneast.api.cognitive.microsoft.com/face/v1.0/detect";
      var params = {
          "returnFaceId": "true",
          "returnFaceLandmarks": "false",
          "returnFaceAttributes":
              "age"
      };


      var sourceImageUrl = document.getElementById("face-picture").value;
      document.querySelector("#sourceImage").src = sourceImageUrl;


      $.ajax({
          url: uriBase + "?" + $.param(params),


          beforeSend: function(xhrObj){
              xhrObj.setRequestHeader("Content-Type","application/json");
              xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key", subscriptionKey);
          },

          type: "POST",


          data: '{"url": ' + '"' + sourceImageUrl + '"}',
      })

      .done(function(data) {
        console.log(JSON.stringify(data, null, 2));


            // $('#new-posts').attr("type", "submit");
            // $('#face-picture').attr("type", "hidden");
            // $('#face-pictures').attr("type", "hidden");
      })
  };
</script>
